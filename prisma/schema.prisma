generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model CartItem {
  id        String   @id
  quantity  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    String
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, productId])
  @@map("cart_items")
}

model OrderItem {
  id        String  @id
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  orderId   String
  productId String
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

model Order {
  id                   String        @id
  orderNumber          String        @unique
  status               OrderStatus   @default(PENDING)
  subtotal             Decimal       @db.Decimal(10, 2)
  tax                  Decimal       @default(0) @db.Decimal(10, 2)
  delivery             Decimal       @default(0) @db.Decimal(10, 2)
  total                Decimal       @db.Decimal(10, 2)
  deliveryType         DeliveryType
  deliveryAddress      String?
  deliveryIsland       String?
  deliveryAtoll        String?
  paymentMethod        String?
  paymentStatus        PaymentStatus @default(PENDING)
  receiptUrl           String?       // Receipt upload for bank transfers
  receiptUploadedAt    DateTime?     
  receiptVerifiedAt    DateTime?     
  receiptVerifiedBy    String?       // Seller who verified the receipt
  receiptNotes         String?       // Notes from seller about receipt verification
  confirmedAt          DateTime?     // When order was confirmed by seller
  preparingAt          DateTime?     // When order preparation started
  readyAt              DateTime?     // When order became ready for pickup
  outForDeliveryAt     DateTime?     // When order was sent out for delivery
  deliveredAt          DateTime?     // When order was delivered
  pickedUpAt           DateTime?     // When order was picked up by customer
  cancelledAt          DateTime?     // When order was cancelled
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  deletedAt            DateTime?     // Soft delete support
  deletedBy            String?       
  deleteReason         DeleteReason? 
  customerId           String
  shopId               String
  items                OrderItem[]
  customer             User          @relation(fields: [customerId], references: [id])
  shop                 Shop          @relation(fields: [shopId], references: [id])

  @@map("orders")
}

model Product {
  id                String          @id @default(cuid())
  name              String
  description       String
  price             Decimal         @db.Decimal(10, 2)
  imagesUrl         String[]
  category          ProductCategory
  tags              String[]
  breed             String?
  age               String?
  gender            PetGender?
  weight            String?
  color             String?
  isLiveAnimal      Boolean         @default(false)
  vaccinationStatus String?
  healthCondition   String?
  specialNeeds      String?
  stock             Int             @default(0)
  lowStockThreshold Int             @default(5)
  isAvailable       Boolean         @default(true)
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  shopId            String
  deletedAt         DateTime?       // Soft delete support
  deletedBy         String?         
  deleteReason      DeleteReason?   
  cartItems         CartItem[]
  orderItems        OrderItem[]
  shop              Shop            @relation(fields: [shopId], references: [id])

  @@map("products")
}

model Shop {
  id                String       @id @default(cuid())
  name              String
  description       String?
  logo              String?
  banner            String?
  phone             String
  email             String?
  island            String
  atoll             String
  address           String
  license           String?
  isVerified        Boolean      @default(false)
  isActive          Boolean      @default(true)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  ownerId           String       @unique
  businessHours     Json?
  category          ShopCategory
  deliveryZones     Json?
  setupComplete     Boolean      @default(false)
  setupStep         Int          @default(1)
  deletedAt         DateTime?    // Soft delete support
  deletedBy         String?      
  deleteReason      DeleteReason?
  // Bank account information
  bankName          String?
  accountHolderName String?
  accountNumber     String?
  orders            Order[]
  products          Product[]
  owner             User         @relation(fields: [ownerId], references: [id])

  @@map("shops")
}

model User {
  id                       String             @id @default(cuid())
  email                    String             @unique
  phone                    String             @unique
  password                 String
  name                     String
  avatar                   String?
  isVerified               Boolean            @default(false)
  idNumber                 String             @unique
  idType                   IDType
  nationality              String?
  emailVerified            Boolean            @default(false)
  island                   String?
  atoll                    String?
  address                  String?
  createdAt                DateTime           @default(now())
  updatedAt                DateTime           @updatedAt
  emailVerificationExpires DateTime?
  emailVerificationToken   String?            @unique
  passwordResetExpires     DateTime?
  passwordResetToken       String?            @unique
  accountType              AccountType        @default(CUSTOMER)
  lastMode                 String?
  userType                 String
  deletedAt                DateTime?          // Soft delete support
  deletedBy                String?            
  deleteReason             DeleteReason?      
  cartItems                CartItem[]
  orders                   Order[]
  shop                     Shop?

  accounts                 Account[]              // NextAuth.js relation
  sessions                 Session[]              // NextAuth.js relation
  
  @@map("users")
}

// Enums
enum AccountType {
  CUSTOMER
  SELLER
  ADMIN
}

enum DeliveryType {
  PICKUP
  DELIVERY
}

enum IDType {
  NATIONAL_ID
  PASSPORT
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING           
  READY_FOR_PICKUP    
  OUT_FOR_DELIVERY   
  DELIVERED
  PICKED_UP
  CANCELLED
}

enum PaymentStatus {
  PENDING
  VERIFIED
  PAID
  FAILED
  REFUNDED
}

enum PetGender {
  MALE
  FEMALE
  UNKNOWN
}

enum ProductCategory {
  CATS
  BIRDS
  FISH
  REPTILES
  SMALL_PETS
  PET_FOOD
  ACCESSORIES
  TOYS
  HEALTH_CARE
}

enum ShopCategory {
  PET_STORE
  GROOMING
  VETERINARY_CLINIC
  BOARDING
}

enum DeleteReason {
  USER_DELETED
  ADMIN_DELETED
  POLICY_VIOLATION
  SPAM
  INAPPROPRIATE_CONTENT
  BUSINESS_CLOSURE
  QUALITY_ISSUES
  OTHER
}

// NextAuth.js Required Models
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Contact {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String
  subject   String
  message   String   @db.Text
  createdAt DateTime @default(now())
  status    String   @default("new") // new, read, replied
  
  @@map("contacts")
}